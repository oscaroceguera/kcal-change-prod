{"version":3,"sources":["webpack:///./src/container/Login/authService.js","webpack:///./src/container/Login/index.js"],"names":["__webpack_require__","u","e","__esModule","default","AuthService","domain","_classCallCheck3","this","fetch","bind","login","getProfile","email","password","_this","method","body","_stringify2","then","res","console","log","setToken","token","_promise2","resolve","getToken","isTokenExpired","_jwtDecode2","exp","Date","now","err","key","value","idToken","localStorage","setItem","getItem","removeItem","url","options","headers","Accept","Content-Type","loggedIn","Authorization","_extends3","_checkStatus","response","json","status","error","Error","statusText","f","w","_core","_styles","_reactRouterDom","_validator","y","k","initialState","loading","Login","props","_this2","_ref","_possibleConstructorReturn3","__proto__","_getPrototypeOf2","call","onChange","setState","_defineProperty3","target","name","handleLogin","Auth","state","history","replace","catch","alert","handleSignup","_asyncToGenerator3","_regenerator2","mark","_callee","data","wrap","_context","prev","next","axios","post","t0","stop","_x","apply","arguments","_props","classes","match","_state","path","link","handleOpt","disabled","isEmail","_react2","createElement","style","height","display","justifyContent","alignItems","Paper","className","root","elevation","TextField","label","margin","width","type","textAlign","marginTop","Button","variant","color","onClick","Link","to","toUpperCase","React","Component","propTypes","PropTypes","object","isRequired","withStyles","theme","mixins","gutters","paddingTop","spacing","unit","paddingBottom","@media (max-width: 376px)"],"mappings":"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","file":"6.bundle.js","sourcesContent":["import decode from 'jwt-decode'\n\nexport default class AuthService {\n  constructor (domain) {\n    this.domain = domain || 'http://localhost:5000/api'\n    this.fetch = this.fetch.bind(this)\n    this.login = this.login.bind(this)\n    this.getProfile = this.getProfile.bind(this)\n  }\n\n  login (email, password) {\n    return this.fetch(`${this.domain}/users/login`, {\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    }).then(res => {\n      console.log('res ==>', res)\n      this.setToken(res.token)\n      return Promise.resolve(res)\n    })\n  }\n\n  loggedIn () {\n    const token = this.getToken()\n    return !!token && !this.isTokenExpired(token)\n  }\n\n  isTokenExpired (token) {\n    try {\n      const decoded = decode(token)\n      if (decoded.exp < Date.now() / 1000) {\n        return true\n      } else {\n        return false\n      }\n    } catch (err) {\n      return false\n    }\n  }\n\n  setToken (idToken) {\n    localStorage.setItem('id_token', idToken)\n  }\n\n  getToken () {\n    return localStorage.getItem('id_token')\n  }\n\n  logout () {\n    localStorage.removeItem('id_token')\n  }\n\n  getProfile () {\n    return decode(this.getToken())\n  }\n\n  fetch (url, options) {\n    const headers = {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n\n    if (this.loggedIn()) {\n      headers['Authorization'] = 'Bearer ' + this.getToken()\n    }\n\n    return fetch(url, {\n      headers,\n      ...options\n    })\n      .then(this._checkStatus)\n      .then(response => response.json())\n  }\n\n  _checkStatus (response) {\n    if (response.status >= 200 && response.status < 300) {\n      return response\n    } else {\n      var error = new Error(response.statusText)\n      error.response = response\n      throw error\n    }\n  }\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { Paper, Avatar, Button, TextField } from '@material-ui/core'\nimport { withStyles } from '@material-ui/core/styles'\nimport {Link} from 'react-router-dom'\nimport { isEmail } from 'validator'\nimport axios from 'axios'\nimport AuthService from './authService'\n\nconst styles = theme => ({\n  root: {\n    ...theme.mixins.gutters(),\n    paddingTop: theme.spacing.unit * 2,\n    paddingBottom: theme.spacing.unit * 2,\n    width: '350px',\n    '@media (max-width: 376px)': {\n      width: '100%'\n    }\n  }\n})\n\nconst initialState = {\n  email: '',\n  password: '',\n  loading: false,\n  error: null\n}\n\nclass Login extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = initialState\n    this.Auth = new AuthService()\n  }\n\n  componentWillMount() {\n    if (this.Auth.loggedIn()) {\n      this.props.history.replace('/dashboard')\n    }\n  }\n\n  onChange = e => {\n    this.setState({[e.target.name]: e.target.value})\n  }\n\n  handleLogin = e => {\n    console.log('handleLogin')\n    this.Auth.login(this.state.email, this.state.password)\n      .then(res => {\n        this.props.history.replace('/');\n      })\n      .catch(err => {\n        alert(err)\n      })\n  }\n\n  handleSignup = async (e) => {\n    console.log('handleSignup')\n    const data = {\n      email: this.state.email,\n      password: this.state.password\n    }\n    try {\n      await axios.post('http://localhost:5000/api/users', data)\n      this.handleLogin()\n    } catch (e) {\n      alert(err)\n    }\n  }\n\n  render () {\n    const { classes, match } = this.props\n    const {email, password} = this.state\n\n    const path = match.path.replace('/', '')\n\n    const link = path === 'login' ? 'signup' : 'login'\n    const handleOpt = path === 'login' ? this.handleLogin : this.handleSignup\n\n    const disabled = !!email && !!password && isEmail(email)\n\n    return (\n      <div style={{height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n        <Paper className={classes.root} elevation={1}>\n          <TextField\n            error={!isEmail(email)}\n            name='email'\n            label='Email'\n            value={email}\n            onChange={this.onChange}\n            margin='normal'\n            style={{ width: '100%' }}\n          />\n          <TextField\n            type='password'\n            name='password'\n            label='Password'\n            value={password}\n            onChange={this.onChange}\n            margin='normal'\n            style={{ width: '100%' }}\n          />\n          <div style={{textAlign: 'center', marginTop: '1em'}}>\n            <Button\n              disabled={!disabled}\n              name='mealType'\n              variant='contained'\n              color='secondary'\n              onClick={handleOpt}\n            >\n              {path}\n            </Button>\n          </div>\n          <div style={{ textAlign: 'center', marginTop: '1em' }}>\n            <Link to={`/${link}`}>{link.toUpperCase()}</Link>\n          </div>\n        </Paper>\n      </div>\n    )\n  }\n}\n\nLogin.propTypes = {\n  classes: PropTypes.object.isRequired\n}\n\nexport default withStyles(styles)(Login)\n"],"sourceRoot":""}