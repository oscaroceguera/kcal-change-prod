{"version":3,"sources":["webpack:///./src/container/Login/authService.js","webpack:///./src/container/Login/index.js"],"names":["__webpack_require__","u","e","__esModule","default","AuthService","domain","_classCallCheck3","this","HOST","fetch","bind","login","getProfile","email","password","_this","method","body","_stringify2","then","res","setToken","token","_promise2","resolve","getToken","isTokenExpired","_jwtDecode2","exp","Date","now","err","key","value","idToken","localStorage","setItem","getItem","removeItem","url","options","headers","Accept","Content-Type","loggedIn","Authorization","_extends3","_checkStatus","response","json","status","error","Error","statusText","f","w","_core","_styles","_reactRouterDom","_validator","k","y","initialState","loading","Login","props","_this2","_ref","_possibleConstructorReturn3","__proto__","_getPrototypeOf2","call","onChange","setState","_defineProperty3","target","name","handleLogin","Auth","state","history","replace","catch","alert","handleSignup","_asyncToGenerator3","_regenerator2","mark","_callee","data","wrap","_context","prev","next","axios","post","t0","stop","_x","apply","arguments","_props","classes","match","_state","path","link","handleOpt","disabled","isEmail","_react2","createElement","style","height","display","justifyContent","alignItems","Paper","className","root","elevation","TextField","label","margin","width","type","textAlign","marginTop","Button","variant","color","onClick","Link","to","toUpperCase","React","Component","propTypes","PropTypes","object","isRequired","withStyles","theme","mixins","gutters","paddingTop","spacing","unit","paddingBottom","@media (max-width: 376px)"],"mappings":"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","file":"6.bundle.js","sourcesContent":["import decode from 'jwt-decode'\n\nconst HOST = process.env.API_URL\n\nexport default class AuthService {\n  constructor (domain) {\n    this.domain = domain || `${HOST}/api`\n    this.fetch = this.fetch.bind(this)\n    this.login = this.login.bind(this)\n    this.getProfile = this.getProfile.bind(this)\n  }\n\n  login (email, password) {\n    return this.fetch(`${this.domain}/users/login`, {\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    }).then(res => {\n      this.setToken(res.token)\n      return Promise.resolve(res)\n    })\n  }\n\n  loggedIn () {\n    const token = this.getToken()\n    return !!token && !this.isTokenExpired(token)\n  }\n\n  isTokenExpired (token) {\n    try {\n      const decoded = decode(token)\n      if (decoded.exp < Date.now() / 1000) {\n        return true\n      } else {\n        return false\n      }\n    } catch (err) {\n      return false\n    }\n  }\n\n  setToken (idToken) {\n    localStorage.setItem('id_token', idToken)\n  }\n\n  getToken () {\n    return localStorage.getItem('id_token')\n  }\n\n  logout () {\n    localStorage.removeItem('id_token')\n  }\n\n  getProfile () {\n    return decode(this.getToken())\n  }\n\n  fetch (url, options) {\n    const headers = {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n\n    if (this.loggedIn()) {\n      headers['Authorization'] = 'Bearer ' + this.getToken()\n    }\n\n    return fetch(url, {\n      headers,\n      ...options\n    })\n      .then(this._checkStatus)\n      .then(response => response.json())\n  }\n\n  _checkStatus (response) {\n    if (response.status >= 200 && response.status < 300) {\n      return response\n    } else {\n      var error = new Error(response.statusText)\n      error.response = response\n      throw error\n    }\n  }\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { Paper, Avatar, Button, TextField } from '@material-ui/core'\nimport { withStyles } from '@material-ui/core/styles'\nimport {Link} from 'react-router-dom'\nimport { isEmail } from 'validator'\nimport axios from 'axios'\nimport AuthService from './authService'\n\nconst HOST = process.env.API_URL\n\nconst styles = theme => ({\n  root: {\n    ...theme.mixins.gutters(),\n    paddingTop: theme.spacing.unit * 2,\n    paddingBottom: theme.spacing.unit * 2,\n    width: '350px',\n    '@media (max-width: 376px)': {\n      width: '100%'\n    }\n  }\n})\n\nconst initialState = {\n  email: '',\n  password: '',\n  loading: false,\n  error: null\n}\n\nclass Login extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = initialState\n    this.Auth = new AuthService()\n  }\n\n  componentWillMount() {\n    if (this.Auth.loggedIn()) {\n      this.props.history.replace('/dashboard')\n    }\n  }\n\n  onChange = e => {\n    this.setState({[e.target.name]: e.target.value})\n  }\n\n  handleLogin = e => {\n    this.Auth.login(this.state.email, this.state.password)\n      .then(res => {\n        this.props.history.replace('/');\n      })\n      .catch(err => {\n        alert(err)\n      })\n  }\n\n  handleSignup = async (e) => {\n    const data = {\n      email: this.state.email,\n      password: this.state.password\n    }\n    try {\n      await axios.post(`${HOST}/api/users`, data)\n      this.handleLogin()\n    } catch (e) {\n      alert(err)\n    }\n  }\n\n  render () {\n    const { classes, match } = this.props\n    const {email, password} = this.state\n\n    const path = match.path.replace('/', '')\n\n    const link = path === 'login' ? 'signup' : 'login'\n    const handleOpt = path === 'login' ? this.handleLogin : this.handleSignup\n\n    const disabled = !!email && !!password && isEmail(email)\n\n    return (\n      <div style={{height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n        <Paper className={classes.root} elevation={1}>\n          <TextField\n            error={!isEmail(email)}\n            name='email'\n            label='Email'\n            value={email}\n            onChange={this.onChange}\n            margin='normal'\n            style={{ width: '100%' }}\n          />\n          <TextField\n            type='password'\n            name='password'\n            label='Password'\n            value={password}\n            onChange={this.onChange}\n            margin='normal'\n            style={{ width: '100%' }}\n          />\n          <div style={{textAlign: 'center', marginTop: '1em'}}>\n            <Button\n              disabled={!disabled}\n              name='mealType'\n              variant='contained'\n              color='secondary'\n              onClick={handleOpt}\n            >\n              {path}\n            </Button>\n          </div>\n          <div style={{ textAlign: 'center', marginTop: '1em' }}>\n            <Link to={`/${link}`}>{link.toUpperCase()}</Link>\n          </div>\n        </Paper>\n      </div>\n    )\n  }\n}\n\nLogin.propTypes = {\n  classes: PropTypes.object.isRequired\n}\n\nexport default withStyles(styles)(Login)\n"],"sourceRoot":""}